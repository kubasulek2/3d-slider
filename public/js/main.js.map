{"version":3,"sources":["main.js"],"names":["htmlElement","constructor","element","this","copy","clone","remove","append","parent","tetragon3d","speed","super","baseSpeed","rotationSpeed","clickedId","faces","children","easing","speedMeasure","start","undefined","stop","lastMeasuredAngle","speedArr","avgSpeed","motionData","isAboutToStop","angleWhenClicked","currentAngle","targetAngle","move","dynamicContent","content","willUpdate","calculateEntryValues","animateElement","computeRotatingTime","updateContent","length","applyEasing","accelerate","css","Math","window","animatePlane","computeEasing","threshold","startEase","delay","speedChange","slowAngles","abs","distance","steps","i","push","parseFloat","toFixed","round","value","rotationTime","flag","floor","measureAngle","Date","computeAvgSpeed","arg","shift","$","attr","reduce","a","b","getTargetAngle","e","target","shouldChangeDirection","direction","filter","el","addClass","planeClickEvent","stopPropagation","id","restoreAnimation","one","targetPlane","removeClass","text","myElement"],"mappings":"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","file":"main.js","sourcesContent":["class htmlElement {\n  constructor(element){\n    this.element = element\n  }\n  copy(){\n    return this.element.clone()\n  }\n  remove(){\n    this.element.remove()\n  }\n  append(parent){\n      this.element.append(parent)\n  }\n}\n\nclass tetragon3d extends htmlElement{\n  constructor(element ,speed){\n    super(element);\n    this.baseSpeed = speed > 1 ? 1 : speed;\n    this.rotationSpeed = speed > 1 ? 1 : speed;\n    this.clickedId = '';\n    this.faces = this.element.children('.face');\n    this.easing = [];\n    this.speedMeasure = {\n      start: undefined,\n      stop: undefined,\n      lastMeasuredAngle: undefined,\n      speedArr: [],\n      avgSpeed: undefined\n    };\n    this.motionData = {\n      isAboutToStop: false,\n      angleWhenClicked: undefined,\n      currentAngle: 0,\n      targetAngle: undefined,\n      move: true\n    };\n    this.dynamicContent = {\n      content: 1,\n      willUpdate: true\n    }\n  }\n  calculateEntryValues() {\n    this.speedMeasure.avgSpeed = (30 / ( this.rotationSpeed * 60 ) );\n\n  }\n\n  animateElement() {\n\n    if ( !this.speedMeasure.avgSpeed ) this.calculateEntryValues();\n\n    if ( this.motionData.move ){\n\n      let rotationSpeed = this.computeRotatingTime();\n\n      this.computeAvgSpeed(rotationSpeed);\n      this.updateContent();\n\n      if (this.easing.length !== 0) this.applyEasing();\n\n      if(this.easing.length === 0 && this.rotationSpeed < this.baseSpeed) this.accelerate();\n\n\n      this.motionData.currentAngle -= this.rotationSpeed;\n      this.motionData.currentAngle = this.motionData.currentAngle <= -360 ? 0 : this.motionData.currentAngle;\n\n      this.element.css( \"transform\", ` translateZ(-250px) rotateY(${this.motionData.currentAngle}deg)` );\n\n      // targetAngle is set in click event, so after click event rotation will stop\n\n      if( Math.round(this.motionData.currentAngle) === this.motionData.targetAngle ){\n        this.motionData.move = false;\n        this.element.css( \"transform\", ` translateZ(-250px) rotateY(${this.motionData.targetAngle}deg)` )\n      }\n\n      window.requestAnimationFrame( ()=> this.animateElement() )\n    }\n    else {\n      this.animatePlane();\n    }\n  }\n\n\n  computeEasing(direction){\n    let distance = Math.abs( Math.abs(this.motionData.targetAngle) - Math.abs(this.motionData.currentAngle) );\n\n    let steps = distance < 20 ? 5 : 10;\n    let threshold, delay, speed, speedChange, startEase, slowAngles, easing = [];\n    let baseSpeed = this.rotationSpeed;\n\n    switch (true) {\n      case distance <= 10 :\n        delay = 0;\n        break;\n      case distance <= 20 :\n        delay = 3;\n        break;\n      case distance <= 30 :\n        delay = 8;\n        break;\n      case distance <= 40 :\n        delay = 15;\n        break;\n      case distance <= 50 :\n        delay = 24;\n        break;\n      case distance <= 60 :\n        delay = 32;\n        break;\n      case distance <= 70 :\n        delay = 40;\n        break;\n      case distance <= 80 :\n        delay = 50;\n        break;\n      case distance <= 90 :\n        delay = 60;\n        break;\n\n    }\n\n    threshold = ( distance - delay ) / steps;\n    speedChange = baseSpeed/steps;\n    speed = baseSpeed;\n    startEase = direction === \"forth\" ? this.motionData.currentAngle - delay : this.motionData.currentAngle + delay;\n    slowAngles = startEase;\n\n    threshold = direction === \"forth\" ? -threshold : threshold;\n\n\n    for(let i = 1; i < steps; i++){\n      slowAngles += threshold;\n      speed -= speedChange;\n\n      if ( speed > 0 ) speed = speed < 0.1 ? 0.1 : speed;\n      else speed = speed > -0.1 ? -0.1 : speed;\n\n      easing[i-1] = [];\n\n      easing[i-1].push( Math.round( slowAngles ) );\n      easing[i-1].push( parseFloat( speed.toFixed(2) ) );\n    }\n    return easing;\n\n  }\n  applyEasing(){\n\n    this.easing.forEach(  value => {\n      if ( Math.round(this.motionData.currentAngle) === value[0] )\n        this.rotationSpeed = value[1];\n    })\n  }\n  computeRotatingTime(){\n\n    let currentAngle = Math.abs( Math.floor(this.motionData.currentAngle) );\n    let rotationTime;\n    let flag = !(currentAngle % 31);\n\n    // return if current angle haven't change from last measurement\n    if (this.speedMeasure.lastMeasuredAngle === currentAngle){\n      return null;\n    }\n\n\n    this.speedMeasure.lastMeasuredAngle = currentAngle;\n\n\n    if(this.speedMeasure.measureAngle === currentAngle){\n      this.speedMeasure.stop = new Date();\n      rotationTime =  (this.speedMeasure.stop - this.speedMeasure.start)/1000;\n      return rotationTime;\n    }\n    //every 31 degrees start time, and angle, at which speed will be measured, are set\n    if ( flag ) {\n      this.speedMeasure.measureAngle = this.motionData.currentAngle === 360 ? 30 : currentAngle + 30;\n      this.speedMeasure.start = new Date();\n    }\n    return null\n  }\n  computeAvgSpeed(arg){\n\n    if ( arg === null ) return;\n\n    this.speedMeasure.speedArr.push(arg);\n\n    if ( this.speedMeasure.speedArr.length > 4 ){\n      this.speedMeasure.speedArr.shift();\n\n    }\n    this.speedMeasure.avgSpeed = this.speedMeasure.speedArr.reduce((a,b) => a + b, 0) / this.speedMeasure.speedArr.length;\n\n  }\n\n  getTargetAngle (e) {\n\n    const targetId = $(e.target).attr(\"id\");\n\n    switch (targetId) {\n      case \"front\":\n        this.motionData.targetAngle = 0;\n        break;\n      case \"right\":\n        this.motionData.targetAngle = -90;\n        break;\n      case \"back\":\n        this.motionData.targetAngle = -180;\n        break;\n      case \"left\":\n        this.motionData.targetAngle = -270;\n        break;\n    }\n  }\n\n  shouldChangeDirection(){\n    let direction = \"forth\";\n    if( this.motionData.targetAngle === 0 ){\n      //if clicked in front plane, which set target angle to 0 , must have special check, cause current angle is always lesser than 0\n      this.rotationSpeed = this.motionData.currentAngle < -180 ? this.rotationSpeed : -this.rotationSpeed;\n      direction = this.motionData.currentAngle < -180 ? \"forth\" :  \"back\"\n    } else if ( this.motionData.currentAngle < this.motionData.targetAngle ){\n      //all the other cases\n      this.rotationSpeed = -this.rotationSpeed;\n      direction = \"back\"\n    }\n    return direction\n  }\n\n  animatePlane(){\n\n    let myPlane = this.faces.filter( ( i,el ) => $(el).attr('id') === this.clickedId);\n\n    myPlane.addClass(\"focus\")\n  }\n\n  planeClickEvent(){\n    this.faces.on( 'click', (e)=> {\n      if( ! this.motionData.isAboutToStop ){\n\n        let target = $(e.currentTarget);\n        e.stopPropagation();\n        this.getTargetAngle(e);\n        this.clickedId = e.target.id;\n\n        let direction = this.shouldChangeDirection();\n        this.motionData.isAboutToStop = true;\n        this.easing = this.computeEasing(direction);\n        this.motionData.angleWhenClicked = this.motionData.currentAngle;\n\n        target.css('cursor', 'initial');\n\n        $('body')\n          .css('cursor', 'pointer')\n          .one('click', (e) => {\n            this.motionData.isAboutToStop = false;\n            target.css('cursor', 'pointer');\n            $(e.currentTarget).css('cursor', 'initial');\n            this.restoreAnimation();\n          });\n      }\n\n    })\n\n\n  }\n\n  restoreAnimation(){\n    let targetPlane = this.faces\n      .filter( ( i,el ) => $(el).attr('id') === this.clickedId);\n      targetPlane.removeClass(\"focus\");\n    this.easing = [];\n    this.motionData.move = true;\n    this.motionData.targetAngle = undefined;\n    this.clickedId = '';\n    this.rotationSpeed = this.rotationSpeed < 0 ? -this.rotationSpeed : this.rotationSpeed;\n\n    targetPlane.one('transitionend',  () => {\n      this.animateElement();\n    })\n\n  }\n\n  accelerate(){\n    this.rotationSpeed =  parseFloat( ( this.rotationSpeed + 0.005 ).toFixed(3) );\n  }\n\n  updateContent(){\n\n    if ( this.motionData.currentAngle < -10 && this.motionData.currentAngle > -20 && this.dynamicContent.willUpdate){\n\n      this.dynamicContent.content = this.rotationSpeed > 0 ? this.dynamicContent.content +2 : this.dynamicContent.content;  //3/7/11...\n      this.dynamicContent.willUpdate = false;\n\n      $(this.faces[2]).text(`face ${this.dynamicContent.content}`);\n      $(this.faces[3]).text(`face ${this.dynamicContent.content +1}`);\n\n    } else if (this.motionData.currentAngle < -20 && this.motionData.currentAngle > -30 && !this.dynamicContent.willUpdate){\n\n      this.dynamicContent.willUpdate = true\n\n    } else if ( this.motionData.currentAngle < -190 && this.motionData.currentAngle > -200 && this.dynamicContent.willUpdate ){\n\n      this.dynamicContent.content = this.rotationSpeed > 0 ? this.dynamicContent.content +2 : this.dynamicContent.content; // 5/9/13...\n      this.dynamicContent.willUpdate = false;\n\n      $(this.faces[0]).text(`face ${this.dynamicContent.content}`);\n      $(this.faces[1]).text(`face ${this.dynamicContent.content + 1}`);\n\n    } else if ( this.motionData.currentAngle < -200 && this.motionData.currentAngle > -210 && !this.dynamicContent.willUpdate){\n\n      this.dynamicContent.willUpdate = true\n    }\n  }\n\n\n}\n\nlet myElement = new tetragon3d($('#top-layer'),.5);\n\n$(() => {\n\n\n  myElement.animateElement();\n  myElement.planeClickEvent();\n\n});"]}